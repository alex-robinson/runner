# runner

Sample parameters, run model ensemble, submit to high-performance cluster queues

Install
=======
    python setup.py install

Usage
=====
Use command-line help:

    job --help

And for each sub-command:

    job product --help
    job sample --help
    job resample --help
    job run --help


Examples
========

Parameter sampling
------------------

Factorial combination of parameters:

    job product a=2,3,4 b=0,1
    
     a      b
     2      0
     2      1
     3      0
     3      1
     4      0
     4      1

Monte-carlo sampling:

    job sample a=U?0,1 b=N?0,1 --size 10 --seed 4

         a      b
    0.425298236238 0.988953805595
    0.904416005793 2.62482283016
    0.68629932356 0.705445219934
    0.397627445478 -0.766770633921
    0.577938292179 -0.522609467132
    0.0967029839014 -0.14215407458
    0.71638422414 0.0495725958965
    0.26977288246 0.519632323554
    0.197268435996 -1.60068615198
    0.800898609767 -0.948326628599

The above command draws 10 samples from "a" as uniform distribution between 0 
and 1 and "b" as normal distribution of mean 0 and standard deviation 1. 
The seed parameter sets the random state, to make the sampling reproducible.
Sampling method defaults to Latin Hypercube Sampling, built on the pyDOE 
package (copied in runner to reduce external dependencies).


Model interface
---------------

    job run -p a=2,3,4 b=0,1 -o out --test -- echo --a {a} --b {b} --out {}

    --a 2 --b 0 --out out/0
    --a 2 --b 1 --out out/1
    --a 3 --b 0 --out out/2
    --a 3 --b 1 --out out/3
    --a 4 --b 0 --out out/4
    --a 4 --b 1 --out out/5

The command above run an ensemble of 6 model versions, by calling `echo` with
following arguments, where {a}, {b} and {} will be formatted using runtime
parameter and run directory values. Without `--test`, the command would be run
in the background, in parallel subprocesses. 

Note `--` is only needed when there is some ambiguity between job run and your
model arguments, as seen by argparse.

The same command could be achieved with --arg-param-prefix and --arg-out-prefix:

    job run -p a=2,3,4 b=0,1 -o out --arg-param-prefix "--{} " --arg-out-prefix "--out " --test echo 

    --out out/0 --a 2 --b 0
    --out out/1 --a 2 --b 1
    --out out/2 --a 3 --b 0
    --out out/3 --a 3 --b 1
    --out out/4 --a 4 --b 0
    --out out/5 --a 4 --b 1

Parameters can also be passed via a file:

    job run -p a=2,3,4 b=0,1 -o out --file-name "params.txt" --file-type "linesep" --test cat {}/params.txt

    a 2
    b 0
    a 2
    b 1
    a 3
    b 0
    a 3
    b 1
    a 4
    b 0
    a 4
    b 1

with a number of file types. File types that involve grouping, such as namelist,
require a group prefix with a `.` separator in the parameter name:

    job run -p g.a=2,3 g.b=0 -o out --file-name "params.txt" --file-type "namelist" --test  cat {}/params.txt

    &g
     a               = 2          
     b               = 0          
    /
    &g
     a               = 3          
     b               = 0          
    /


Parameter ensembles generated by `job sample` can also be used via `-i/--params-file` option. See inline help for more options how to submit the model to HPC queue etc.

Resampling
----------

    job resample --help
